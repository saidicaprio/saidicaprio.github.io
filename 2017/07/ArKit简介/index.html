<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    
    <title>ARKit简介 | Sai&#39;s Cabin</title>
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta name="description" content="Hi, I&#39;m SaiDicaprio, a iOS Developer from China.">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="ARKit简介 | Sai&#39;s Cabin">
    <meta name="twitter:description" content="Hi, I&#39;m SaiDicaprio, a iOS Developer from China.">

    <meta property="og:type" content="article">
    <meta property="og:title" content="ARKit简介 | Sai&#39;s Cabin">
    <meta property="og:description" content="Hi, I&#39;m SaiDicaprio, a iOS Developer from China.">

    
    <meta name="author" content="贺嘉炜">
    
    <link rel="stylesheet" href="/css/vno.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">

    

    <meta name="generator" content="hexo"/>
    
    <link rel="alternate" type="application/rss+xml" title="Sai&#39;s Cabin" href="/atom.xml">
    

    <link rel="canonical" href="https://saidicaprio.com/2017/07/ArKit简介/"/>

                 
</head>

<body class="home-template no-js">
    <script src="//cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>

    
<header class="panel-cover panel-cover--collapsed" style="background-image: url(/images/background-cover.jpg)">
  <div class="panel-main">
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/" title="前往 Sai&#39;s Cabin 的主页"><img src="/images/avatar.jpg" width="80" alt="Sai&#39;s Cabin logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage for Sai&#39;s Cabin">Sai&#39;s Cabin</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">落月摇情满江树</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">Hi, I'm SaiDicaprio, a iOS Developer from China.</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />

        <div class="navigation-wrapper">
          <div>
          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="访问博客" class="blog-button">博客</a></li>
            
              <li class="navigation__item"><a href="/">首页</a></li>
            
              <li class="navigation__item"><a href="./aboutme">关于</a></li>
            
            </ul>
          </nav>
          </div>
          <div>
          <nav class="cover-navigation navigation--social">
  <ul class="navigation">

  <!-- Weibo-->
  

  <!-- Github -->
  
  <li class="navigation__item">
    <a href="https://github.com/hjw6160602" title="查看我的GitHub主页" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>


<!-- Stack Overflow -->
        

  <!-- Google Plus -->
  

<!-- Facebook -->

  
<!-- Twitter -->

  

  <li class="navigation__item">
    <a href="/atom.xml" title="RSS" target="_blank">
      <i class='social fa fa-rss'></i>
      <span class="label">RSS</span>
    </a>
  </li>



  </ul>
</nav>

          </div>
        </div>

      </div>

    </div>

    <div class="panel-cover--overlay cover-blue"></div>
  </div> 
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single">

  <header class="post-header">
    <div class="post-meta">
      <time datetime="2017-07-15T07:31:40.000Z" class="post-list__meta--date date">2017-07-15</time> &#8226; <span class="post-meta__tags tags">于&nbsp;
  <a class="tag-link" href="/tags/能工巧匠集/">能工巧匠集</a>
 </span>
      <span class="page-pv">
      &nbsp;阅读&nbsp;<span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>
      </span> 
   
    </div>
    <h1 class="post-title">ARKit简介</h1>
  </header>

  <section class="post">
    <p><img src="https://willjayh.oss-cn-shanghai.aliyuncs.com/imgs/ARKitLogo.png" alt=""> </p>
<p>ARKit是WWDC发布iOS11系统所新增框架。ARKit是一个移动AR平台，提供高层次的API，可在iOS 11 + A9芯片及以上（iPhone 6s起）上使用。</p>
<p>Session 602 Introducing ARKit: Augmented Reality for iOS</p>
<p><a href="https://developer.apple.com/videos/play/wwdc2017/602/" target="_blank" rel="noopener">https://developer.apple.com/videos/play/wwdc2017/602/</a></p>
<h2 id="注意点："><a href="#注意点：" class="headerlink" title="注意点："></a>注意点：</h2><ul>
<li>ARKit框架提供了两种AR技术，一种是基于3D场景(<code>SceneKit</code>)实现的增强现实，一种是基于2D场景(<code>SpriktKit</code>)实现的增强现实</li>
<li>一般主流都是基于3D实现AR技术，ARKit不仅支持3D引擎<code>SceneKit</code>，还支持2D引擎<code>SpriktKit</code></li>
<li>要想显示AR效果，必须要依赖于苹果的游戏引擎框架，主要原因是游戏引擎才可以加载物体模型</li>
</ul>
<p>ARKit需要的开发环境：</p>
<ul>
<li>1.Xcode版本：Xcode9及以上</li>
<li>2.iOS系统:iOS11及以上</li>
<li>3.iOS设备：处理器A9及以上（6S机型及以上）</li>
<li>4.MacOS系统：10.12.4及以上（安装Xcode9对Mac系统版本有要求）</li>
</ul>
<h2 id="一、ARKit简介"><a href="#一、ARKit简介" class="headerlink" title="一、ARKit简介"></a>一、ARKit简介</h2><h3 id="ARKit如何工作？"><a href="#ARKit如何工作？" class="headerlink" title="ARKit如何工作？"></a>ARKit如何工作？</h3><p><img src="https://willjayh.oss-cn-shanghai.aliyuncs.com/imgs/ARKit框架结构.png" alt=""> </p>
<h4 id="Step1-Tracking-追踪"><a href="#Step1-Tracking-追踪" class="headerlink" title="Step1. Tracking 追踪"></a>Step1. Tracking 追踪</h4><ul>
<li>World tracking 世界跟踪</li>
<li>视觉惯性测距</li>
<li>无需外部设置 十分方便！</li>
</ul>
<h4 id="Step2-Scene-Understanding-场景理解"><a href="#Step2-Scene-Understanding-场景理解" class="headerlink" title="Step2. Scene Understanding 场景理解"></a>Step2. Scene Understanding 场景理解</h4><ul>
<li>平面检测(屋子的地板或桌子等大平面)</li>
<li>Hit-testing 碰撞测试 </li>
<li>光线评估，根据环境光线确定虚拟物体的渲染</li>
</ul>
<h4 id="Step3-Rendering-渲染"><a href="#Step3-Rendering-渲染" class="headerlink" title="Step3. Rendering 渲染"></a>Step3. Rendering 渲染</h4><ul>
<li>Easy integration</li>
<li>渲染生成 AR views</li>
<li>自定义渲染</li>
</ul>
<h4 id="下图是一个与框架关系图，通过下图可以看出"><a href="#下图是一个与框架关系图，通过下图可以看出" class="headerlink" title="下图是一个与框架关系图，通过下图可以看出"></a>下图是一个<arkit>与<scenekit>框架关系图，通过下图可以看出</scenekit></arkit></h4><p><code>ARKit</code>框架中中显示AR视图的<code>ARSCNView</code>继承于<code>SceneKit</code>框架中的<code>SCNView</code>，而<code>SCNView</code>又继承于<code>UIView</code><br><code>SCNView</code>的作用是显示一个3D场景，<code>ARScnView</code>的作用也是显示一个3D场景，只不过这个3D场景是由摄像头捕捉到的现实世界图像构成的</p>
<p>在一个完整的虚拟增强现实体验中，<code>ARKit</code>框架只负责将真实世界画面转变为一个3D场景，这一个转变的过程主要分为两个环节：</p>
<ul>
<li>由<code>ARCamera</code>负责捕捉摄像头画面</li>
<li>由ARSession负责搭建3D场景</li>
</ul>
<p><img src="https://willjayh.oss-cn-shanghai.aliyuncs.com/imgs/ARKit框架流程图.png" alt=""> </p>
<blockquote>
<p>综上所述，ARKit捕捉3D现实世界使用的是自身的功能，这个功能是在iOS11新增的。而ARKit在3D现实场景中添加虚拟物体使用的是父类SCNView的功能，这个功能早在iOS8时就已经添加（SceneKit是iOS8新增）</p>
</blockquote>
<h2 id="二、Tracking-追踪"><a href="#二、Tracking-追踪" class="headerlink" title="二、Tracking 追踪"></a>二、Tracking 追踪</h2><p><img src="https://willjayh.oss-cn-shanghai.aliyuncs.com/imgs/ARKitCapturing.png" alt=""> </p>
<h3 id="2-1-影响追踪质量的因素"><a href="#2-1-影响追踪质量的因素" class="headerlink" title="2.1 影响追踪质量的因素"></a>2.1 影响追踪质量的因素</h3><ul>
<li>不能间断的传感器数据</li>
<li>特征显著的周边环境</li>
<li>静态场景</li>
</ul>
<h3 id="2-2-如何追踪？"><a href="#2-2-如何追踪？" class="headerlink" title="2.2 如何追踪？"></a>2.2 如何追踪？</h3><h5 id="ARSession的参与者主要有两个ARWorldTrackingSessionConfiguration与ARFrame"><a href="#ARSession的参与者主要有两个ARWorldTrackingSessionConfiguration与ARFrame" class="headerlink" title="ARSession的参与者主要有两个ARWorldTrackingSessionConfiguration与ARFrame"></a><code>ARSession</code>的参与者主要有两个<code>ARWorldTrackingSessionConfiguration</code>与<code>ARFrame</code></h5><h6 id="ARWorldTrackingSessionConfiguration（会话追踪配置）"><a href="#ARWorldTrackingSessionConfiguration（会话追踪配置）" class="headerlink" title="ARWorldTrackingSessionConfiguration（会话追踪配置）"></a><code>ARWorldTrackingSessionConfiguration</code>（会话追踪配置）</h6><p>跟踪设备的方向和位置,以及检测设备摄像头看到的现实世界的表面。它的内部实现了一系列非常庞大的算法计算以及调用了你的iPhone必要的传感器来检测手机的移动及旋转甚至是翻滚。</p>
<p>当<code>ARWorldTrackingSessionConfiguration</code>计算出相机在3D世界中的位置时，它本身并不持有这个位置数据，而是将其计算出的位置数据交给<code>ARSession</code>去管理，而相机的位置数据对应的类就是<code>ARFrame</code></p>
<p><code>ARCamera</code>只负责捕捉图像，不参与数据的处理。它属于3D场景中的一个环节，每一个3D Scene都会有一个Camera</p>
<p>它们三者之间的关系看起来如下图：</p>
<p><img src="https://willjayh.oss-cn-shanghai.aliyuncs.com/imgs/ARKitSession关系图.png" alt=""></p>
<p>ARCamera在3D世界的位置看起来是这样的:</p>
<p><img src="https://willjayh.oss-cn-shanghai.aliyuncs.com/imgs/ARKitCamera.png" alt=""></p>
<h3 id="2-2-追踪状态？"><a href="#2-2-追踪状态？" class="headerlink" title="2.2 追踪状态？"></a>2.2 追踪状态？</h3><h4 id="共有四种状态，在受限时，最好通知用户"><a href="#共有四种状态，在受限时，最好通知用户" class="headerlink" title="共有四种状态，在受限时，最好通知用户"></a>共有四种状态，在受限时，最好通知用户</h4><p><img src="https://willjayh.oss-cn-shanghai.aliyuncs.com/imgs/跟踪状态.png" alt=""><br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">session</span><span class="params">(<span class="number">_</span> session: ARSession, cameraDidChangeTrackingState camera: ARCamera)</span></span> &#123; </span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">case</span> .limited(<span class="keyword">let</span> reason) = camera.trackingState &#123;</span><br><span class="line">		<span class="comment">// Notify user of limited tracking state</span></span><br><span class="line">	&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Session中断 或者 相机不可用，就追踪停止<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sessionWasInterrupted</span><span class="params">(<span class="number">_</span> session: ARSession)</span></span> &#123; </span><br><span class="line">	showOverlay()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sessionInterruptionEnded</span><span class="params">(<span class="number">_</span> session: ARSession)</span></span> &#123; </span><br><span class="line">	hideOverlay()</span><br><span class="line">	<span class="comment">// Optionally restart experience</span></span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="三、Scene-Understanding-场景理解"><a href="#三、Scene-Understanding-场景理解" class="headerlink" title="三、Scene Understanding 场景理解"></a>三、Scene Understanding 场景理解</h2><h3 id="3-1-平面检测"><a href="#3-1-平面检测" class="headerlink" title="3.1 平面检测"></a>3.1 平面检测</h3><p><img src="https://willjayh.oss-cn-shanghai.aliyuncs.com/imgs/ARKitSceneUnderstanding.png" alt=""> </p>
<ul>
<li>相对于重力的水平面</li>
<li>跨多个帧运行</li>
<li>表面对齐</li>
<li>平面合并</li>
</ul>
<h3 id="3-2-Hit-testing-碰撞测试"><a href="#3-2-Hit-testing-碰撞测试" class="headerlink" title="3.2 Hit-testing 碰撞测试"></a>3.2 Hit-testing 碰撞测试</h3><ul>
<li>现实世界的光线交叉</li>
<li>使用场景信息</li>
<li>距离排序的结果</li>
<li>碰撞测试的类型<ul>
<li>有范围的存在平面</li>
<li>存在平面</li>
<li>预估平面</li>
<li>特征点</li>
</ul>
</li>
</ul>
<p><img src="https://willjayh.oss-cn-shanghai.aliyuncs.com/imgs/ARKitHit-Testing.png" alt=""> </p>
<p>根据类型的不同，碰撞测试的运作方法会不一样</p>
<h3 id="3-3-光线评估"><a href="#3-3-光线评估" class="headerlink" title="3.3 光线评估"></a>3.3 光线评估</h3><ul>
<li>基于捕获图像的环境强度</li>
<li>默认为1000流明（光束的能量单位）</li>
<li>默认启用</li>
</ul>
<h2 id="四、-Rendering-渲染"><a href="#四、-Rendering-渲染" class="headerlink" title="四、 Rendering 渲染"></a>四、 Rendering 渲染</h2><p>在一个完整的虚拟增强现实体验中，将虚拟物体现实在3D场景中是由<code>SceneKit</code>框架来完成中：每一个虚拟的物体都是一个节点SCNNode,每一个节点构成了一个场景SCNScene,无数个场景构成了3D世界。</p>
<h3 id="4-2-自定义-Rendering-渲染"><a href="#4-2-自定义-Rendering-渲染" class="headerlink" title="4.2 自定义 Rendering 渲染"></a>4.2 自定义 Rendering 渲染</h3><ul>
<li>绘制摄像头北京</li>
<li>更新虚拟摄像头</li>
<li>更新光线</li>
<li>更新重力场下的transforms</li>
</ul>
<h2 id="五、总结"><a href="#五、总结" class="headerlink" title="五、总结"></a>五、总结</h2><h3 id="ARKit工作流程"><a href="#ARKit工作流程" class="headerlink" title="ARKit工作流程"></a>ARKit工作流程</h3><p>ARKit与SceneKit的配合：通过ARSCNView，绘制捕捉的图像，更新SCNCamera，更新光照，将SCNNode映射到ARAnchor上</p>
<p><img src="https://willjayh.oss-cn-shanghai.aliyuncs.com/imgs/ARKit工作流程.png" alt=""> </p>
<ul>
<li>1.ARSCNView加载场景SCNScene</li>
<li>2.SCNScene启动相机ARCamera开始捕捉场景</li>
<li>3.捕捉场景后ARSCNView开始将场景数据交给Session</li>
<li>4.Session通过管理ARSessionConfiguration实现场景的追踪并且返回一个ARFrame</li>
<li>5.给ARSCNView的scene添加一个子节点（3D物体模型）</li>
</ul>
<p><code>ARSessionConfiguration</code>捕捉相机3D位置的意义就在于: 能够在添加3D物体模型的时候计算出3D物体模型相对于相机的真实的矩阵位置(在3D坐标系统中，有一个世界坐标系和一个本地坐标系)</p>

  </section>

</article>

<section class="read-more">
           
    
               
            <div class="read-more-item">
                <span class="read-more-item-dim">最近的文章</span>
                <h2 class="post-list__post-title post-title"><a href="/2017/09/配置SourceTree脚本/" title="配置SourceTree脚本">配置SourceTree脚本</a></h2>
                <p class="excerpt">
                
                首先我们来看下SourceTree的Custom Actions是什么？Custom Actions是SourceTree提供给用户去执行自己的一些脚本的一些设置。首先打开SourceTree，点击菜单栏上的Preferences（或者使用Command＋，），点击Custom Actions就可以
                &hellip;
                </p>
                <div class="post-list__meta"><time datetime="2017-09-12T08:37:46.000Z" class="post-list__meta--date date">2017-09-12</time> &#8226; <span class="post-list__meta--tags tags">于&nbsp;
  <a class="tag-link" href="/tags/iOS知识库/">iOS知识库</a>
</span><a class="btn-border-small" href="/2017/09/配置SourceTree脚本/">继续阅读</a></div>
                           
            </div>
        
        
               
            <div class="read-more-item">
                <span class="read-more-item-dim">更早的文章</span>
                <h2 class="post-list__post-title post-title"><a href="/2017/04/现代化OC语法/" title="现代化OC语法">现代化OC语法</a></h2>
                <p class="excerpt">
                
                随着Swift的加入，OC在不也在不断向着新的编程方式靠拢，虽然OC是我很喜欢的一门很优雅的语言，但是毕竟编程讲究的是效率，时代的大浪下，OC的很多写法也顺应大潮做出了一些相应的改变。下面我们来看一下都有哪些地方现代化OC语法做出的改变。
##1. 将一些单纯的方法转换为属性12- (BOOL)is
                &hellip;
                </p>
                <div class="post-list__meta"><time datetime="2017-04-11T01:31:10.000Z" class="post-list__meta--date date">2017-04-11</time> &#8226; <span class="post-list__meta--tags tags">于&nbsp;
  <a class="tag-link" href="/tags/能工巧匠集/">能工巧匠集</a>
</span><a class="btn-border-small" href="/2017/04/现代化OC语法/">继续阅读</a></div>
                       
            </div>
        
     
   
   
  
</section>

  

            <footer class="footer">
    <span class="footer__copyright">
        本站点采用 <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>
    </span>
    <span class="footer__copyright">
        基于 <a href="http://hexo.io">Hexo</a> 搭建，感谢 <a href="https://pages.github.com/">GitHub Pages</a> 提供免费的托管服务
    </span>
    <span class="footer__copyright">
        &copy; 2023 - 本站使用 <a href="https://github.com/monniya/hexo-theme-new-vno ">new-vno</a> 主题,
        由<a href="https://monniya.com ">@Monniya</a> 修改自 <a href="https://github.com/lenbo-ma/hexo-theme-vno" target="_blank">Vno</a>, 原创出自<a href="http://github.com/onevcat/vno" target="_blank">onevcat</a>
    </span>
    
</footer>


        </div>
    </div>

     
    


    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    
</body>
</html>
